<% def populate_section(match) %>
    <h5 class="card-title">
        <% if match.user1_id == current_user.id %>
            <%= User.find(match.user2_id).first_name %> 
        <% else %>
            <%= User.find(match.user1_id).first_name %>
        <% end %>
    </h5>
    <p>
        <% Post.all.where(id: match.post_id).each do |post| %>
            <%= post.title %>
        <% end %>
    </p>
<% end %>

<div class="card">
    <h5 class="card-header"><%= fa_icon "handshake-o", text: "Your Matches" %></h5>
    <div class="card-body">
        <% confirmed_matches = [] %>
        <% received_requests = [] %>
        <% sent_requests = [] %>
        <% matches = Match.all.where(user1_id: current_user.id).or(Match.all.where(user2_id: current_user.id)) %>
        <% matches.each do | match | %>
            <% if match.confirmed? %>
                <% confirmed_matches << match %>
            <% else %>
                <% if current_user.id == match.user1_id %>
                    <% if match.user1_confirmed == true %>
                        <% sent_requests << match %>
                    <% else %>
                        <% received_requests << match %>
                    <% end %>
                <% else %>
                    <% if match.user2_confirmed == true %>
                        <% sent_requests << match %>
                    <% else %>
                        <% received_requests << match %>
                    <% end %>
                <% end %>
            <% end %>
            </p>
        <% end %>
        <% if confirmed_matches.size > 0 %>
            <h4>Confirmed Matches:</h4>
            <% confirmed_matches.each do |match| %>
                <% populate_section(match) %>
                <%= link_to(match) do %>
                    <%= fa_icon "info-circle", text: "Show" %>
                <% end %>
            <% end %>
        <% end %>
        <br><br>
        <% if sent_requests.size > 0 %>
            <h4>Sent Requests:</h4>
            <% sent_requests.each do |match| %>
                <% populate_section(match) %>
                <% if match.user1_id == current_user.id %>
                    <%= link_to(user_path(User.find(match.user2_id))) do %>
                        <%= fa_icon "info-circle", text: "Show" %>
                    <% end %>
                <% else %>
                    <%= link_to(user_path(User.find(match.user1_id))) do %>
                        <%= fa_icon "info-circle", text: "Show" %>
                    <% end %>
                <% end %>
                
            <% end %>
        <% end %>
        <br><br>
        <% if received_requests.size > 0 %>
            <h4>Received Requests:</h4>
            <% received_requests.each do |match| %>
                <% populate_section(match) %>
                <%= link_to(accept_match_path(match), method: :post) do %>
                    <%= fa_icon "heart", text: "Accept" %>
                <% end %>
                <%= link_to(match, method: :delete, data: {confirm: "Are you sure that you want to delete this?"}) do %>
                    <%= fa_icon "times", text: "Deny" %>
                <% end %>
            <% end %>
        <% end %>
        <br><br>
    </div>
</div>